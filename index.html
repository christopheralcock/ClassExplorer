<head>
	<style>
		body {
			margin: auto;
		}

		table {
			width: 100%;
		}

	</style>
</head>

<body>

	<h1 id="title">Member count and overlap for class</h1>
	<h2>Click rows to see breakdowns for other classes.</h2>

	<div id="explanation">
		What is this? Click for explanation
	</div>

	<div id="wait">
		Please wait - fetching data
		<img src="http://textfiles.com/underconstruction/CoColosseumField5989Construction.gif">
	</div>

	<table id="classes">
		<tr>
			<th id="classURI"></th>
			<th id="countHeader"></th>
		</tr>
	</table>

	<script>

		var table = document.getElementById("classes");
		var wait = document.getElementById("wait");
		var url = new URL(window.location.href);

		if (url.searchParams.get("class") == null) {
			url.searchParams.set('class', encodeURI("https://id.parliament.uk/schema/Group"));
			window.location.replace(url);
		}
		var classToExplore = url.searchParams.get("class");
		var dataUrl = new URL("https://api.parliament.uk/query/class_count.json");
		dataUrl.searchParams.set('class', classToExplore);

		var title = document.getElementById("title");
		title.innerText = "Member count and overlap for " + decodeURI(classToExplore);

		fetch(dataUrl)
			.then(function (response) {
				wait.innerHTML = null;
				return response.json();
			})
			.then(
				function (json) {
					var classURI = document.getElementById("classURI");
					classURI.innerText = "Class URI";
					var countHeader = document.getElementById("countHeader");
					countHeader.innerText = "Count of members in common with " + decodeURI(classToExplore);
					json.results.bindings.forEach(
						function (element) {
							var row;
							element.otherClass.value == classToExplore ? row = table.insertRow(1) : row = table.insertRow(-1);
							var leftCell = row.insertCell(0);
							url = new URL(window.location.href);
							row.onmouseover = function () { row.style.backgroundColor = "Aquamarine" }
							row.onmouseout = function () { row.style.backgroundColor = "white" }
							var leftLink = document.createElement("a");
							leftLink.innerText = element.otherClass.value;
							url.searchParams.set('class', encodeURI(element.otherClass.value));
							leftLink.setAttribute("href", url.toString());
							leftCell.appendChild(leftLink);
							var rightCell = row.insertCell(1);
							rightCell.innerHTML = element.count.value;
						}
					);
				}
			);
	</script>
</body>
